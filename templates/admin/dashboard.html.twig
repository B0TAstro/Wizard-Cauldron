{% extends 'base.html.twig' %}
{% block title %}Dashboard Admin
{% endblock %}

{% block body %}
	<h1 class="text-xl font-semibold mb-4">Dashboard Admin</h1>
	<div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
		<div class="rounded-xl border border-white/10 bg-white/5 p-4">
			<div class="text-sm text-white/70">Total Users</div>
			<div class="mt-1 text-2xl font-semibold">{{ totalUsers ?? 0 }}</div>
		</div>

		<div class="rounded-xl border border-white/10 bg-white/5 p-4">
			<div class="text-sm text-white/70">Total Spells</div>
			<div class="mt-1 text-2xl font-semibold">{{ totalSpells ?? 0 }}</div>
		</div>

		<div class="rounded-xl border border-white/10 bg-white/5 p-4">
			<div class="text-sm text-white/70">Active Spells</div>
			<div class="mt-1 text-2xl font-semibold">{{ activeSpells ?? 0 }}</div>
		</div>
	</div>

	<section class="mb-8">
		<h2 class="text-lg font-medium mb-3">Users</h2>

		<div class="overflow-x-auto rounded-xl border border-white/10">
			<table class="w-full text-sm">
				<thead class="bg-white/5 text-white/70">
					<tr>
						<th class="px-3 py-2">Pseudo</th>
						<th class="px-3 py-2">Email</th>
						<th class="px-3 py-2">Roles</th>
						<th class="px-3 py-2">Coins</th>
						<th class="px-3 py-2">Unlocked</th>
						<th class="px-3 py-2">Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for u in users %}
						<tr class="border-t text-center border-white/10 even:bg-white/5">
							<td class="px-3 py-2 font-medium">{{ u.pseudo }}</td>
							<td class="px-3 py-2">{{ u.email }}</td>
							<td class="px-3 py-2">
								{% set isAdmin = 'ROLE_ADMIN' in u.roles %}
								<span class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs border {{ isAdmin ? 'border-amber-400/40 text-amber-200' : 'border-white/20 text-white/70' }}">
									{{ u.roles|join(', ') }}
								</span>
							</td>

							<td class="px-3 py-2">{{ u.coins }}</td>
							<td class="px-3 py-2">{{ u.unlocked }}/{{ u.total }}</td>
							<td class="px-3 py-2">
								<div class="flex justify-end gap-2 items-center">
									{{ form_start(toggleForms[u.id], { attr: { class: 'inline' } }) }}
									<button class="px-2.5 py-1.5 rounded-lg border {{ ('ROLE_ADMIN' in u.roles) ? 'border-amber-400/40 hover:bg-amber-500/10' : 'border-white/20 hover:bg-white/10' }}">
										{{ ('ROLE_ADMIN' in u.roles) ? 'Revoke Admin' : 'Make Admin' }}
									</button>
									{{ form_end(toggleForms[u.id]) }}

									{{ form_start(coinsForms[u.id], { attr: { class: 'inline-flex items-center' } }) }}
									{{ form_widget(coinsForms[u.id].amount, {
										attr: {
										class: 'w-23 text-center rounded-lg border border-white/20 bg-black/40 px-2 py-1.5',
										inputmode: 'numeric',
										pattern: '-?[0-9]*',
										placeholder: '+/- Coins',
										title: 'Tape un nombre puis Entr√©e'
										}
									}) }}
									<button type="submit" class="sr-only">Apply</button>
									{{ form_end(coinsForms[u.id]) }}

									<a href="{{ path('admin_user_edit', {id: u.id}) }}" class="px-2.5 py-1.5 rounded-lg border border-white/20 hover:bg-white/10">Edit</a>

									<form method="post" action="{{ path('admin_user_delete', {id: u.id}) }}" onsubmit="return confirm('Delete {{ u.email }} ?')">
										<input type="hidden" name="_token" value="{{ csrf_token('del_user_' ~ u.id) }}">
										<button class="px-2.5 py-1.5 rounded-lg border border-red-500/40 text-red-300 hover:bg-red-500/10">Delete</button>
									</form>

								</div>
							</td>

						</tr>
					{% else %}
						<tr>
							<td colspan="6" class="px-3 py-8 text-center text-white/60">No users yet</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</section>

	<section>
		<h2 class="text-lg font-medium mb-3">Spells</h2>
		<div class="overflow-x-auto rounded-xl border border-white/10">
			<table class="w-full text-sm">
				<thead class="bg-white/5 text-white/70">
					<tr>
						<th class="px-3 py-2 text-left">Name</th>
						<th class="px-3 py-2 text-left">Slug</th>
						<th class="px-3 py-2">Rarity</th>
						<th class="px-3 py-2">Description</th>
						<th class="px-3 py-2">Active</th>
						<th class="px-3 py-2 text-right">Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for s in spells %}
						<tr class="border-t border-white/10 even:bg-white/5">
							<td class="px-3 py-2 font-medium">{{ s.name }}</td>
							<td class="px-3 py-2 text-white/70">{{ s.slug }}</td>
							<td class="px-3 py-2 text-center">{{ s.rarity }}</td>
							<td class="px-3 py-2 text-center">{{ s.description }}</td>
							<td class="px-3 py-2 text-center">
								<span class="inline-block w-2.5 h-2.5 rounded-full {{ s.isActive ? 'bg-green-400' : 'bg-red-400' }}"></span>
							</td>
							<td class="px-3 py-2">
								<div class="flex justify-end gap-2">
									<a href="{{ path('admin_spell_edit', {id: s.id}) }}" class="px-2.5 py-1.5 rounded-lg border border-white/20 hover:bg-white/10">Edit</a>
									<form method="post" action="{{ path('admin_spell_delete', {id: s.id}) }}" onsubmit="return confirm('Delete {{ s.name }} ?')">
										<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ s.id) }}">
										<button class="px-2.5 py-1.5 rounded-lg border border-red-500/40 text-red-300 hover:bg-red-500/10">Delete</button>
									</form>
								</div>
							</td>
						</tr>
					{% else %}
						<tr>
							<td colspan="5" class="px-3 py-8 text-center text-white/60">No spells yet</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</section>
{% endblock %}
