{% extends 'base.html.twig' %}
{% block title %}Edit user
{% endblock %}

{% block body %}
	<h1 class="text-xl font-semibold mb-4">Edit user</h1>

	<div class="max-w-2xl rounded-2xl border border-white/10 bg-white/5 p-5">
		{{ form_start(form, { attr: { class: 'space-y-4' } }) }}

		<div>
			{{ form_label(form.pseudo, null, { label_attr: { class: 'block text-sm mb-1 text-white/80' } }) }}
			{{ form_widget(form.pseudo, { attr: { class: 'w-full rounded-lg border border-white/15 bg-black/40 px-3 py-2' } }) }}
			{{ form_errors(form.pseudo) }}
		</div>

		<div>
			{{ form_label(form.email, null, { label_attr: { class: 'block text-sm mb-1 text-white/80' } }) }}
			{{ form_widget(form.email, { attr: { class: 'w-full rounded-lg border border-white/15 bg-black/40 px-3 py-2' } }) }}
			{{ form_errors(form.email) }}
		</div>

		<div class="grid grid-cols-2 gap-3">
			<div>
				{{ form_label(form.coins, null, { label_attr: { class: 'block text-sm mb-1 text-white/80' } }) }}
				{{ form_widget(form.coins, { attr: { class: 'w-full rounded-lg border border-white/15 bg-black/40 px-3 py-2' } }) }}
				{{ form_errors(form.coins) }}
			</div>

			<div>
				{{ form_label(form.roles, null, { label_attr: { class: 'block text-sm mb-1 text-white/80' } }) }}
				<div class="rounded-lg border border-white/10 p-3">
					{{ form_widget(form.roles) }}
				</div>
				{{ form_errors(form.roles) }}
			</div>
		</div>

		<div>
			{{ form_label(form.newPassword, null, { label_attr: { class: 'block text-sm mb-1 text-white/80' } }) }}
			{{ form_widget(form.newPassword, { attr: { class: 'w-full rounded-lg border border-white/15 bg-black/40 px-3 py-2' } }) }}
			{{ form_errors(form.newPassword) }}
			<p class="text-xs text-white/50 mt-1">Leave blank to keep current password.</p>
		</div>

		<div class="flex items-center gap-2 pt-2">
			<button class="px-3 py-2 rounded-lg bg-white text-black hover:bg-white/90">Save</button>
			<a href="{{ path('admin_user') }}" class="px-3 py-2 rounded-lg border border-white/15 hover:bg-white/10">Cancel</a>
		</div>

		{{ form_end(form) }}
	</div>

	<hr class="my-6 border-white/10">

	<h2 class="text-lg font-medium mb-3">Collection</h2>

	{{ form_start(grantForm, { attr: { class: 'mb-4 flex items-center gap-2' } }) }}
	{{ form_widget(grantForm.spell, {vttr: { class: 'w-64 rounded-lg border border-white/15 bg-black/40 px-3 py-2' }}) }}
	<button class="px-3 py-2 rounded-lg border border-white/20 hover:bg-white/10">
		Grant
	</button>
	{{ form_end(grantForm) }}
	<div class="overflow-x-auto rounded-xl border border-white/10">
		<table class="w-full text-sm">
			<thead class="bg-white/5 text-white/70">
				<tr>
					<th class="px-3 py-2 text-left">Name</th>
					<th class="px-3 py-2 text-left">Rarity</th>
					<th class="px-3 py-2 text-left">Description</th>
					<th class="px-3 py-2 text-right">Actions</th>
				</tr>
			</thead>
			<tbody>
				{% for s in ownedSpells %}
					<tr class="border-t border-white/10 even:bg-white/5">
						<td class="px-3 py-2">{{ s.name }}</td>
						<td class="px-3 py-2">{{ s.rarity|capitalize }}</td>
						<td class="px-3 py-2 text-white/70 truncate">{{ s.description }}</td>
						<td class="px-3 py-2">
							<div class="flex justify-end">
								{{ form_start(revokeForms[s.id]) }}
								{{ form_widget(revokeForms[s.id].spellId) }}
								<button class="px-2.5 py-1.5 rounded-lg border border-red-500/40 text-red-300 hover:bg-red-500/10">
									Revoke
								</button>
								{{ form_end(revokeForms[s.id]) }}
							</div>
						</td>
					</tr>
				{% else %}
					<tr>
						<td colspan="4" class="px-3 py-6 text-center text-white/60">No spells.</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
{% endblock %}