{% extends 'base.html.twig' %}
{% block title %}My Collection
{% endblock %}

{% block body %}
	<div class="mb-5 flex items-center justify-between">
		<h1 class="text-xl font-semibold">My Collection</h1>

		<div class="flex items-center gap-2 text-sm">
			{% set r = activeRarity %}
			{% set link = path('collection') %}
			<a href="{{ link }}" class="px-2 py-1 rounded-lg border {{ r ? 'border-white/10' : 'border-white/20 bg-white/10' }}">All</a>
			{% for opt in ['common','rare','epic','legendary'] %}
				<a href="{{ path('collection', {rarity: opt}) }}" class="px-2 py-1 rounded-lg border hover:bg-white/10 {{ r == opt ? 'border-white/20 bg-white/10' : 'border-white/10' }}">
					{{ opt|capitalize }}
				</a>
			{% endfor %}
		</div>
	</div>

	<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
		{% for s in spells %}
			{% set isUnlocked = s.id in unlockedIds %}
			{% set rarityColor = {
                'common':'border-slate-400/30',
                'rare':'border-sky-400/30',
                'epic':'border-violet-400/30',
                'legendary':'border-amber-400/40'
            }[s.rarity|lower] ?? 'border-white/10' %}

			<a href="{{ path('admin_spell_show', {id: s.id}) }}" class="group relative rounded-2xl border {{ rarityColor }} bg-black/40 p-3 hover:scale-[1.02] transition block overflow-hidden">
				<div class="aspect-square rounded-xl border border-white/10 bg-black/60 grid place-items-center overflow-hidden">
					{% if s.imageUrl %}
						<img src="{{ s.imageUrl }}" alt="{{ s.name }}" class="h-3/4 w-3/4 object-contain {{ isUnlocked ? '' : 'opacity-30 blur-[1px]' }}">
					{% else %}
						<span class="text-white/30 text-xs">{{ isUnlocked ? 'No image' : '' }}</span>
					{% endif %}

					{% if not isUnlocked %}
						<div class="absolute inset-0 grid place-items-center">
							<div class="rounded-full border border-white/15 bg-black/40 px-2 py-0.5 text-xs text-white/70">Locked</div>
						</div>
					{% endif %}
				</div>

				<div class="mt-2">
					<div class="text-sm font-medium {{ isUnlocked ? 'text-white' : 'text-white/50' }}">{{ s.name }}</div>
					<div class="text-xs text-white/40 truncate">{{ s.description }}</div>
				</div>
			</a>
		{% else %}
			<div class="col-span-full text-center text-white/60 py-16">No spells.</div>
		{% endfor %}
	</div>
{% endblock %}